name = "safety-learning-platform"
compatibility_date = "2024-01-15"
compatibility_flags = ["nodejs_compat"]

# Pages配置
pages_build_output_dir = "public"

# 生产环境变量
[env.production.vars]
ENVIRONMENT = "production"
API_BASE_URL = "https://safety-learning-platform.pages.dev"

# KV命名空间配置
[[kv_namespaces]]
binding = "SAFETY_KV"
id = "your-kv-namespace-id"
preview_id = "your-kv-preview-id"

# D1数据库配置
[[d1_databases]]
binding = "SAFETY_DB"
database_name = "safety-learning-db"
database_id = "your-d1-database-id"

# 构建配置
[build]
command = "npm run build"
cwd = "."

# 开发服务器配置
[dev]
ip = "0.0.0.0"
port = 8788
local_protocol = "http"

# 安全头配置
[[headers]]
for = "/*"
[headers.values]
X-Frame-Options = "DENY"
X-Content-Type-Options = "nosniff"
X-XSS-Protection = "1; mode=block"
Referrer-Policy = "strict-origin-when-cross-origin"
Permissions-Policy = "camera=(), microphone=(), geolocation=()"
Strict-Transport-Security = "max-age=31536000; includeSubDomains; preload"

# 静态资源缓存配置
[[headers]]
for = "/assets/*"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "*.css"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "*.js"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "*.png"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "*.jpg"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
for = "*.svg"
[headers.values]
Cache-Control = "public, max-age=31536000, immutable"

# PWA文件缓存配置
[[headers]]
for = "/manifest.json"
[headers.values]
Cache-Control = "public, max-age=86400"

[[headers]]
for = "/sw.js"
[headers.values]
Cache-Control = "public, max-age=0, must-revalidate"

# API路由缓存配置
[[headers]]
for = "/api/*"
[headers.values]
Cache-Control = "no-cache, no-store, must-revalidate"

# 重定向配置
[[redirects]]
from = "/admin"
to = "/admin/"
status = 301

[[redirects]]
from = "/video"
to = "/video1"
status = 302

[[redirects]]
from = "/quiz"
to = "/quiz1"
status = 302

# SPA路由配置
[[redirects]]
from = "/*"
to = "/index.html"
status = 200
conditions = {Header = "Accept: text/html"}

# 错误页面配置
[pages]
error_pages = [
  { code = 404, path = "/404.html" },
  { code = 500, path = "/500.html" }
]

# 观测性配置
[observability]
enabled = true

# 分析配置
[analytics]
enabled = true 